<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla Sociom√©trica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .config-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }
        
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .points-config {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
        }
        
        .point-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .point-item label {
            margin: 0;
            min-width: 120px;
        }
        
        .point-item input {
            width: 80px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .table-section {
            display: none;
            overflow-x: auto;
        }
        
        .relation-title {
            text-align: center;
            font-size: 1.5em;
            color: #764ba2;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }
        
        th, td {
            border: 2px solid #667eea;
            padding: 12px;
            text-align: center;
            min-width: 60px;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        td input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        td input:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }
        
        .diagonal {
            background: #e9ecef;
        }
        
        .totals-row {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .totals-row td {
            font-size: 1.1em;
            color: #333;
        }
        
        .highlight-column {
            background: #c8e6c9 !important;
            animation: glow 1.5s ease-in-out;
            border: 2px solid #4caf50 !important;
        }
        
        .highlight-total {
            background: #81c784 !important;
            color: white !important;
            font-size: 1.3em !important;
            animation: glow 1.5s ease-in-out;
        }
        
        @keyframes glow {
            0%, 100% { background: #c8e6c9; }
            50% { background: #a5d6a7; }
        }
        
        .header-center {
            text-align: center;
            font-size: 1.1em;
            padding: 10px;
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .success {
            background: #00b894;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .instructions p {
            color: #1565c0;
            margin-bottom: 5px;
        }
        
        .btn-validate {
            background: #00b894;
            margin-top: 20px;
        }
        
        .btn-validate:hover {
            background: #00a383;
        }
        
        .btn-reset {
            background: #e74c3c;
            margin-left: 10px;
        }
        
        .btn-reset:hover {
            background: #c0392b;
        }
        
        .btn-sociogram {
            background: #9b59b6;
            margin-left: 10px;
        }
        
        .btn-sociogram:hover {
            background: #8e44ad;
        }
        
        .sociogram-section {
            display: none;
        }
        
        #sociogramCanvas {
            width: 100%;
            height: 800px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
        }
        
        .legend-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }
        
        .legend-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-arrow {
            width: 50px;
            height: 20px;
            position: relative;
        }
        
        .legend-text {
            color: #333;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Tabla Sociom√©trica</h1>
        
        <div class="config-section" id="configSection">
            <h2>Configuraci√≥n - Versi√≥n beta - Tom√°s Cuesta</h2>
            
            <div class="form-group">
                <label for="relationTitle">T√≠tulo de la relaci√≥n medida:</label>
                <input type="text" id="relationTitle" placeholder="Ej: ¬øCon qui√©n te gustar√≠a trabajar?">
            </div>
            
            <div class="form-group">
                <label for="numUsers">N√∫mero de participantes:</label>
                <input type="number" id="numUsers" min="2" max="100" value="5">
            </div>
            
            <div class="form-group">
                <label for="numChoices">N√∫mero m√°ximo de elecciones por persona:</label>
                <input type="number" id="numChoices" min="1" max="10" value="3">
            </div>
            
            <div class="points-config" id="pointsConfig">
                <label><strong>Puntos por posici√≥n de elecci√≥n:</strong></label>
                <div id="pointsInputs"></div>
            </div>
            
            <button onclick="generateTable()">Generar Tabla</button>
        </div>
        
        <div class="table-section" id="tableSection">
            <div class="relation-title" id="displayTitle"></div>
            
            <div class="instructions">
                <p><strong>Instrucciones:</strong></p>
                <p>‚Ä¢ Introduce el orden de elecci√≥n (1, 2, 3...) en cada celda</p>
                <p>‚Ä¢ No es obligatorio completar todas las elecciones</p>
                <p>‚Ä¢ No puedes elegir a la misma persona dos veces</p>
                <p>‚Ä¢ Las celdas grises (diagonal) est√°n bloqueadas</p>
            </div>
            
            <div style="overflow-x: auto;">
                <table id="sociometryTable"></table>
            </div>
            
            <div class="error" id="errorMsg"></div>
            <div class="success" id="successMsg">‚úì Datos validados correctamente. Puntuaciones calculadas.</div>
            
            <div style="margin-top: 20px;">
                <button class="btn-validate" onclick="validateAndCalculate()">Validar y Calcular</button>
                <button class="btn-sociogram" id="btnSociogram" onclick="showSociogram()" style="display:none;">Ver Sociograma</button>
                <button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
            </div>
        </div>
        
        <div class="sociogram-section" id="sociogramSection">
            <div class="relation-title" id="sociogramTitle"></div>
            
            <div class="legend-box" id="legendBox">
                <h3>Leyenda de elecciones:</h3>
                <div class="legend-items" id="legendItems"></div>
                <p style="color: #666; font-style: italic; margin-top: 15px; font-size: 13px;">
                    * El tama√±o del c√≠rculo representa los puntos totales recibidos por cada participante
                </p>
            </div>
            
            <canvas id="sociogramCanvas"></canvas>
            <div style="margin-top: 20px;">
                <button onclick="showTable()">Volver a la Tabla</button>
                <button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
            </div>
        </div>
    </div>
    
    <script>
        let config = {
            numUsers: 0,
            numChoices: 0,
            points: [],
            relationTitle: ''
        };
        
        let sociogramData = {
            totals: [],
            choices: []
        };
        
        const arrowColors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e', '#16a085', '#d35400'];
        
        const greekLetters = ['Œ±', 'Œ≤', 'Œ≥', 'Œ¥', 'Œµ', 'Œ∂', 'Œ∑', 'Œ∏', 'Œπ', 'Œ∫', 'Œª', 'Œº', 'ŒΩ', 'Œæ', 'Œø', 'œÄ', 'œÅ', 'œÉ', 'œÑ', 'œÖ', 'œÜ', 'œá', 'œà', 'œâ'];
        
        function getParticipantLabel(index) {
            if (index < 26) {
                return String.fromCharCode(65 + index);
            } else if (index < 26 + greekLetters.length) {
                return greekLetters[index - 26];
            } else {
                const adjustedIndex = index - 26 - greekLetters.length;
                const firstLetter = String.fromCharCode(65 + Math.floor(adjustedIndex / 26));
                const secondLetter = String.fromCharCode(65 + (adjustedIndex % 26));
                return firstLetter + secondLetter;
            }
        }
        
        document.getElementById('numChoices').addEventListener('input', function() {
            const numChoices = parseInt(this.value);
            const pointsConfig = document.getElementById('pointsConfig');
            const pointsInputs = document.getElementById('pointsInputs');
            
            if (numChoices > 0) {
                pointsConfig.style.display = 'block';
                pointsInputs.innerHTML = '';
                
                for (let i = 1; i <= numChoices; i++) {
                    const div = document.createElement('div');
                    div.className = 'point-item';
                    div.innerHTML = `
                        <label>${i}¬™ elecci√≥n:</label>
                        <input type="number" id="points${i}" min="0" value="${numChoices - i + 1}">
                        <span>puntos</span>
                    `;
                    pointsInputs.appendChild(div);
                }
            } else {
                pointsConfig.style.display = 'none';
            }
        });
        
        document.getElementById('numChoices').dispatchEvent(new Event('input'));
        
        function generateTable() {
            const relationTitle = document.getElementById('relationTitle').value.trim();
            const numUsers = parseInt(document.getElementById('numUsers').value);
            const numChoices = parseInt(document.getElementById('numChoices').value);
            
            if (!relationTitle) {
                alert('Por favor, introduce un t√≠tulo para la relaci√≥n');
                return;
            }
            
            if (numUsers < 2 || numUsers > 100) {
                alert('El n√∫mero de participantes debe estar entre 2 y 100');
                return;
            }
            
            if (numChoices < 1 || numChoices >= numUsers) {
                alert('El n√∫mero de elecciones debe ser al menos 1 y menor que el n√∫mero de participantes');
                return;
            }
            
            const points = [];
            for (let i = 1; i <= numChoices; i++) {
                const pointValue = parseInt(document.getElementById(`points${i}`).value);
                if (isNaN(pointValue) || pointValue < 0) {
                    alert(`Por favor, introduce un valor v√°lido para la ${i}¬™ elecci√≥n`);
                    return;
                }
                points.push(pointValue);
            }
            
            config = {
                numUsers,
                numChoices,
                points,
                relationTitle
            };
            
            createTable();
            document.getElementById('configSection').style.display = 'none';
            document.getElementById('tableSection').style.display = 'block';
            document.getElementById('displayTitle').textContent = relationTitle;
        }
        
        function createTable() {
            const table = document.getElementById('sociometryTable');
            table.innerHTML = '';
            
            const thead = document.createElement('thead');
            
            const topRow = document.createElement('tr');
            const topTh = document.createElement('th');
            topTh.colSpan = config.numUsers + 1;
            topTh.className = 'header-center';
            topTh.textContent = 'Persona elegida';
            topRow.appendChild(topTh);
            thead.appendChild(topRow);
            
            const headerRow = document.createElement('tr');
            const cornerTh = document.createElement('th');
            cornerTh.textContent = 'Elige';
            headerRow.appendChild(cornerTh);
            
            for (let i = 0; i < config.numUsers; i++) {
                const th = document.createElement('th');
                th.textContent = getParticipantLabel(i);
                headerRow.appendChild(th);
            }
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            for (let row = 0; row < config.numUsers; row++) {
                const tr = document.createElement('tr');
                const th = document.createElement('th');
                th.textContent = getParticipantLabel(row);
                tr.appendChild(th);
                
                for (let col = 0; col < config.numUsers; col++) {
                    const td = document.createElement('td');
                    
                    if (row === col) {
                        td.className = 'diagonal';
                        td.textContent = '‚Äî';
                    } else {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = '1';
                        input.max = config.numChoices;
                        input.id = `cell-${row}-${col}`;
                        input.addEventListener('input', function() {
                            this.value = this.value.replace(/[^0-9]/g, '');
                        });
                        td.appendChild(input);
                    }
                    
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            }
            
            const totalsRow = document.createElement('tr');
            totalsRow.className = 'totals-row';
            totalsRow.innerHTML = '<th>PUNTOS TOTALES</th>';
            for (let i = 0; i < config.numUsers; i++) {
                const td = document.createElement('td');
                td.id = `total-${i}`;
                td.textContent = '0';
                totalsRow.appendChild(td);
            }
            tbody.appendChild(totalsRow);
            
            table.appendChild(tbody);
        }
        
        function validateAndCalculate() {
            const errorMsg = document.getElementById('errorMsg');
            const successMsg = document.getElementById('successMsg');
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
            
            for (let row = 0; row < config.numUsers; row++) {
                const choices = [];
                
                for (let col = 0; col < config.numUsers; col++) {
                    if (row === col) continue;
                    
                    const input = document.getElementById(`cell-${row}-${col}`);
                    const value = input.value.trim();
                    
                    if (value !== '') {
                        const numValue = parseInt(value);
                        
                        if (numValue < 1 || numValue > config.numChoices) {
                            errorMsg.textContent = `Error en ${getParticipantLabel(row)}: El valor debe estar entre 1 y ${config.numChoices}`;
                            errorMsg.style.display = 'block';
                            input.focus();
                            return;
                        }
                        
                        if (choices.includes(numValue)) {
                            errorMsg.textContent = `Error en ${getParticipantLabel(row)}: No puedes repetir el mismo orden de elecci√≥n`;
                            errorMsg.style.display = 'block';
                            input.focus();
                            return;
                        }
                        
                        choices.push(numValue);
                    }
                }
            }
            
            const totals = new Array(config.numUsers).fill(0);
            
            for (let row = 0; row < config.numUsers; row++) {
                for (let col = 0; col < config.numUsers; col++) {
                    if (row === col) continue;
                    
                    const input = document.getElementById(`cell-${row}-${col}`);
                    const value = input.value.trim();
                    
                    if (value !== '') {
                        const position = parseInt(value);
                        totals[col] += config.points[position - 1];
                    }
                }
            }
            
            for (let i = 0; i < config.numUsers; i++) {
                const totalCell = document.getElementById(`total-${i}`);
                totalCell.textContent = totals[i];
                totalCell.classList.remove('highlight-total');
                
                for (let row = 0; row < config.numUsers; row++) {
                    const cellId = `cell-${row}-${i}`;
                    const cell = document.getElementById(cellId);
                    if (cell) {
                        cell.parentElement.classList.remove('highlight-column');
                    }
                }
                const diagonalCell = document.querySelector(`#sociometryTable tbody tr:nth-child(${i + 1}) td:nth-child(${i + 2})`);
                if (diagonalCell) {
                    diagonalCell.classList.remove('highlight-column');
                }
            }
            
            const maxPoints = Math.max(...totals);
            const winnerIndices = [];
            
            for (let i = 0; i < totals.length; i++) {
                if (totals[i] === maxPoints) {
                    winnerIndices.push(i);
                }
            }
            
            if (maxPoints > 0) {
                winnerIndices.forEach(maxIndex => {
                    for (let row = 0; row < config.numUsers; row++) {
                        if (row !== maxIndex) {
                            const cell = document.getElementById(`cell-${row}-${maxIndex}`);
                            if (cell) {
                                cell.parentElement.classList.add('highlight-column');
                            }
                        } else {
                            const diagonalCell = document.querySelector(`#sociometryTable tbody tr:nth-child(${maxIndex + 1}) td:nth-child(${maxIndex + 2})`);
                            if (diagonalCell) {
                                diagonalCell.classList.add('highlight-column');
                            }
                        }
                    }
                    document.getElementById(`total-${maxIndex}`).classList.add('highlight-total');
                });
            }
            
            if (winnerIndices.length > 1) {
                const winnerLabels = winnerIndices.map(i => getParticipantLabel(i)).join(', ');
                successMsg.textContent = `‚úì Datos validados correctamente. Empate entre: ${winnerLabels} (${maxPoints} puntos cada uno)`;
            } else if (winnerIndices.length === 1) {
                successMsg.textContent = `‚úì Datos validados correctamente. Ganador: ${getParticipantLabel(winnerIndices[0])} (${maxPoints} puntos)`;
            } else {
                successMsg.textContent = '‚úì Datos validados correctamente. Puntuaciones calculadas.';
            }
            
            successMsg.style.display = 'block';
            document.getElementById('btnSociogram').style.display = 'inline-block';
            
            sociogramData.totals = [...totals];
            sociogramData.choices = [];
            
            for (let row = 0; row < config.numUsers; row++) {
                for (let col = 0; col < config.numUsers; col++) {
                    if (row === col) continue;
                    
                    const input = document.getElementById(`cell-${row}-${col}`);
                    const value = input.value.trim();
                    
                    if (value !== '') {
                        const position = parseInt(value);
                        sociogramData.choices.push({
                            from: row,
                            to: col,
                            order: position
                        });
                    }
                }
            }
        }
        
        function resetConfig() {
            if (confirm('¬øSeguro que quieres crear una nueva configuraci√≥n? Se perder√°n los datos actuales.')) {
                document.getElementById('configSection').style.display = 'block';
                document.getElementById('tableSection').style.display = 'none';
                document.getElementById('sociogramSection').style.display = 'none';
                document.getElementById('successMsg').style.display = 'none';
                document.getElementById('errorMsg').style.display = 'none';
                document.getElementById('btnSociogram').style.display = 'none';
            }
        }
        
        function showSociogram() {
            document.getElementById('tableSection').style.display = 'none';
            document.getElementById('sociogramSection').style.display = 'block';
            document.getElementById('sociogramTitle').textContent = config.relationTitle;
            createLegendHTML();
            drawSociogram();
        }
        
        function showTable() {
            document.getElementById('sociogramSection').style.display = 'none';
            document.getElementById('tableSection').style.display = 'block';
        }
        
        function createLegendHTML() {
            const legendItems = document.getElementById('legendItems');
            legendItems.innerHTML = '';
            
            for (let i = 0; i < config.numChoices; i++) {
                const color = arrowColors[i % arrowColors.length];
                const width = Math.max(8 - i * 1.5, 2);
                
                const item = document.createElement('div');
                item.className = 'legend-item';
                
                const canvas = document.createElement('canvas');
                canvas.width = 60;
                canvas.height = 25;
                canvas.className = 'legend-arrow';
                
                const ctx = canvas.getContext('2d');
                
                ctx.beginPath();
                ctx.moveTo(5, 12);
                ctx.lineTo(45, 12);
                ctx.strokeStyle = color;
                ctx.lineWidth = width;
                ctx.stroke();
                
                const headLength = 10;
                ctx.beginPath();
                ctx.moveTo(45, 12);
                ctx.lineTo(45 - headLength * Math.cos(-Math.PI / 6), 12 - headLength * Math.sin(-Math.PI / 6));
                ctx.lineTo(45 - headLength * Math.cos(Math.PI / 6), 12 - headLength * Math.sin(Math.PI / 6));
                ctx.closePath();
                ctx.fillStyle = color;
                ctx.fill();
                
                const text = document.createElement('span');
                text.className = 'legend-text';
                text.textContent = `${i + 1}¬™ elecci√≥n (${config.points[i]} puntos)`;
                
                item.appendChild(canvas);
                item.appendChild(text);
                legendItems.appendChild(item);
            }
        }
        
        function drawSociogram() {
            const canvas = document.getElementById('sociogramCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.35;
            
            const positions = [];
            for (let i = 0; i < config.numUsers; i++) {
                const angle = (i * 2 * Math.PI / config.numUsers) - Math.PI / 2;
                positions.push({
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle),
                    label: getParticipantLabel(i),
                    points: sociogramData.totals[i]
                });
            }
            
            sociogramData.choices.forEach(choice => {
                const from = positions[choice.from];
                const to = positions[choice.to];
                const order = choice.order;
                
                const color = arrowColors[(order - 1) % arrowColors.length];
                const width = Math.max(8 - (order - 1) * 1.5, 2);
                
                drawArrow(ctx, from.x, from.y, to.x, to.y, color, width, positions);
            });
            
            const maxPoints = Math.max(...sociogramData.totals);
            const minRadius = 25;
            const maxRadius = 60;
            
            positions.forEach(pos => {
                let circleRadius = minRadius;
                if (maxPoints > 0) {
                    circleRadius = minRadius + (maxRadius - minRadius) * (pos.points / maxPoints);
                }
                
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, circleRadius, 0, 2 * Math.PI);
                ctx.fillStyle = '#667eea';
                ctx.fill();
                ctx.strokeStyle = '#5568d3';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                ctx.font = `bold ${Math.min(circleRadius * 0.7, 24)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(pos.label, pos.x, pos.y);
                
                ctx.fillStyle = '#333';
                ctx.font = `${Math.min(circleRadius * 0.4, 14)}px Arial`;
                ctx.fillText(`(${pos.points})`, pos.x, pos.y + circleRadius + 15);
            });
        }
        
        function drawArrow(ctx, fromX, fromY, toX, toY, color, width, positions) {
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            const maxPoints = Math.max(...sociogramData.totals);
            const minRadius = 25;
            const maxRadius = 60;
            
            const fromIndex = positions.findIndex(p => p.x === fromX && p.y === fromY);
            const toIndex = positions.findIndex(p => p.x === toX && p.y === toY);
            
            let fromRadius = minRadius;
            let toRadius = minRadius;
            
            if (maxPoints > 0) {
                fromRadius = minRadius + (maxRadius - minRadius) * (positions[fromIndex].points / maxPoints);
                toRadius = minRadius + (maxRadius - minRadius) * (positions[toIndex].points / maxPoints);
            }
            
            const startX = fromX + Math.cos(angle) * (fromRadius + 5);
            const startY = fromY + Math.sin(angle) * (fromRadius + 5);
            const endX = toX - Math.cos(angle) * (toRadius + 5);
            const endY = toY - Math.sin(angle) * (toRadius + 5);
            
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.stroke();
            
            const headLength = 15 + width;
            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(
                endX - headLength * Math.cos(angle - Math.PI / 6),
                endY - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                endX - headLength * Math.cos(angle + Math.PI / 6),
                endY - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }
    </script>
</body>
</html>