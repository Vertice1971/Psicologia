<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabla Sociom√©trica</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

h1 {
    text-align: center;
    color: #667eea;
    margin-bottom: 30px;
    font-size: 2em;
}

.config-section {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 30px;
}

.config-section h2 {
    color: #333;
    margin-bottom: 20px;
    font-size: 1.3em;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    color: #555;
    font-weight: 600;
}

input[type="text"],
input[type="number"] {
    width: 100%;
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input[type="text"]:focus,
input[type="number"]:focus {
    outline: none;
    border-color: #667eea;
}

.points-config {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: white;
    border-radius: 5px;
}

.point-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.point-item label {
    margin: 0;
    min-width: 120px;
}

.point-item input {
    width: 80px;
}

button {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 10px;
}

button:hover {
    background: #5568d3;
}

button:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.table-section {
    display: none;
    overflow-x: auto;
}

table {
    width: max-content;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    table-layout: fixed;
}

th, td {
    border: 2px solid #667eea;
    padding: 3px;
    text-align: center;
    min-width: 26px;
    max-width: 26px;
    overflow: hidden;
}

th {
    background: #667eea;
    color: white;
    font-weight: 600;
}

td input {
    width: 22px;
    max-width: 22px;
    padding: 2px;
    text-align: center;
    border: 1px solid #ddd;
    border-radius: 3px;
}

td input:disabled {
    background: #f0f0f0;
    cursor: not-allowed;
}

.diagonal {
    background: #e9ecef;
}

.totals-row {
    background: #f8f9fa;
    font-weight: bold;
}

.totals-row td {
    font-size: 1.1em;
    color: #333;
}

.highlight-column {
    background: #c8e6c9 !important;
    animation: glow 1.5s ease-in-out;
    border: 2px solid #4caf50 !important;
}

.highlight-total {
    background: #81c784 !important;
    color: white !important;
    font-size: 1.3em !important;
    animation: glow 1.5s ease-in-out;
}

@keyframes glow {
    0%, 100% { background: #c8e6c9; }
    50% { background: #a5d6a7; }
}

.header-center {
    text-align: center;
    font-size: 1.1em;
    padding: 10px;
    background: #f8f9fa;
    font-weight: 600;
    color: #667eea;
    border: 2px solid #667eea;
}

.error {
    color: #e74c3c;
    font-size: 14px;
    margin-top: 5px;
    display: none;
}

.success {
    background: #00b894;
    color: white;
    padding: 15px;
    border-radius: 5px;
    text-align: center;
    margin-top: 20px;
    display: none;
}

.instructions {
    background: #e3f2fd;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 4px solid #2196f3;
}

.instructions p {
    color: #1565c0;
    margin-bottom: 5px;
}

.btn-validate {
    background: #00b894;
    margin-top: 20px;
}

.btn-validate:hover {
    background: #00a383;
}

.btn-reset {
    background: #e74c3c;
    margin-left: 10px;
}

.btn-reset:hover {
    background: #c0392b;
}

.btn-sociogram {
   	background: #9b59b6;
    margin-left: 10px;
}

.btn-sociogram:hover {
    background: #8e44ad;
}

.sociogram-section {
    display: none;
}

#sociogramCanvas {
    width: 100%;
    height: 800px;
    border: 2px solid #667eea;
    border-radius: 10px;
    background: white;
}

.legend-box {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 2px solid #667eea;
}

.legend-box h3 {
    color: #667eea;
    margin-bottom: 15px;
    font-size: 1.2em;
}

.legend-items {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.legend-arrow {
    width: 50px;
    height: 20px;
}

.legend-text {
    color: #333;
    font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
<h1>üìä Tabla Sociom√©trica</h1>

<div class="config-section" id="configSection">
<h2>Configuraci√≥n - Versi√≥n beta - Tom√°s Cuesta</h2>

<div class="form-group">
<label for="relationTitle">T√≠tulo de la relaci√≥n medida:</label>
<input type="text" id="relationTitle" placeholder="Ej: ¬øCon qui√©n te gustar√≠a trabajar?">
</div>

<div class="form-group">
<label for="numUsers">N√∫mero de participantes:</label>
<input type="number" id="numUsers" min="2" max="100" value="5">
</div>

<div class="form-group">
<label for="numChoices">N√∫mero m√°ximo de elecciones por persona:</label>
<input type="number" id="numChoices" min="1" max="10" value="3">
</div>

<div class="points-config" id="pointsConfig">
<label><strong>Puntos por posici√≥n de elecci√≥n:</strong></label>
<div id="pointsInputs"></div>
</div>

<button onclick="generateTable()">Generar Tabla</button>
</div>


<div class="table-section" id="tableSection">
<div class="relation-title" id="displayTitle"></div>

<div class="instructions">
<p><strong>Instrucciones:</strong></p>
<p>‚Ä¢ Introduce el orden de elecci√≥n (1, 2, 3...) en cada celda</p>
<p>‚Ä¢ No es obligatorio completar todas las elecciones</p>
<p>‚Ä¢ No puedes elegir a la misma persona dos veces</p>
<p>‚Ä¢ Las celdas grises (diagonal) est√°n bloqueadas</p>
</div>

<div style="overflow-x: auto;">
<table id="sociometryTable"></table>
</div>

<div class="error" id="errorMsg"></div>
<div class="success" id="successMsg">‚úì Datos validados correctamente. Puntuaciones calculadas.</div>

<div style="margin-top: 20px;">
<button class="btn-validate" onclick="validateAndCalculate()">Validar y Calcular</button>
<button class="btn-sociogram" id="btnSociogram" onclick="showSociogram()" style="display:none;">Ver Sociograma</button>
<button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
</div>
</div>


<div class="sociogram-section" id="sociogramSection">
<div class="relation-title" id="sociogramTitle"></div>

<div class="legend-box" id="legendBox">
<h3>Leyenda de elecciones:</h3>
<div class="legend-items" id="legendItems"></div>
<p style="color: #666; font-style: italic; margin-top: 15px; font-size: 13px;">* El tama√±o del c√≠rculo representa los puntos totales recibidos</p>
</div>

<canvas id="sociogramCanvas"></canvas>

<div style="margin-top: 20px;">
<button onclick="showTable()">Volver a la Tabla</button>
<button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
</div>
</div>

</div>


<script>
let config = {
    numUsers: 0,
    numChoices: 0,
    points: [],
    relationTitle: ''
};

let sociogramData = {
    totals: [],
    choices: []
};

const arrowColors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e', '#16a085', '#d35400'];

const greekLetters = ['Œ±','Œ≤','Œ≥','Œ¥','Œµ','Œ∂','Œ∑','Œ∏','Œπ','Œ∫','Œª','Œº','ŒΩ','Œæ','Œø','œÄ','œÅ','œÉ','œÑ','œÖ','œÜ','œá','œà','œâ'];

function getParticipantLabel(index) {
    if (index < 26) return String.fromCharCode(65 + index);
    if (index < 26 + greekLetters.length) return greekLetters[index - 26];
    const adjusted = index - 26 - greekLetters.length;
    return String.fromCharCode(65 + Math.floor(adjusted/26)) + String.fromCharCode(65 + (adjusted%26));
}

document.getElementById('numChoices').addEventListener('input', function() {
    const numChoices = parseInt(this.value);
    const box = document.getElementById('pointsConfig');
    const zone = document.getElementById('pointsInputs');
    if (numChoices > 0) {
        box.style.display = 'block';
        zone.innerHTML = '';
        for (let i=1;i<=numChoices;i++) {
            const div=document.createElement('div');
            div.className='point-item';
            div.innerHTML = `
                <label>${i}¬™ elecci√≥n:</label>
                <input type="number" id="points${i}" min="0" value="${numChoices-i+1}">
                <span>puntos</span>`;
            zone.appendChild(div);
        }
    } else {
        box.style.display='none';
    }
});
document.getElementById('numChoices').dispatchEvent(new Event('input'));


function generateTable() {
    const relationTitle = document.getElementById('relationTitle').value.trim();
    const numUsers = parseInt(document.getElementById('numUsers').value);
    const numChoices = parseInt(document.getElementById('numChoices').value);

    const points=[];
    for(let i=1;i<=numChoices;i++){
        const v=parseInt(document.getElementById(`points${i}`).value);
        if (isNaN(v)||v<0) return;
        points.push(v);
    }

    config={numUsers,numChoices,points,relationTitle};

    createTable();
    document.getElementById('configSection').style.display='none';
    document.getElementById('tableSection').style.display='block';
    document.getElementById('displayTitle').textContent=relationTitle;
}


function createTable() {
    const table = document.getElementById('sociometryTable');
    table.innerHTML='';

    const thead=document.createElement('thead');
    const top=document.createElement('tr');
    const topTh=document.createElement('th');
    topTh.colSpan=config.numUsers+1;
    topTh.className='header-center';
    topTh.textContent='Persona elegida';
    top.appendChild(topTh);
    thead.appendChild(top);

    const header=document.createElement('tr');
    const corner=document.createElement('th');
    corner.textContent='Elige';
    header.appendChild(corner);

    for(let i=0;i<config.numUsers;i++){
        const th=document.createElement('th');
        th.textContent=getParticipantLabel(i);
        header.appendChild(th);
    }
    thead.appendChild(header);
    table.appendChild(thead);

    const tbody=document.createElement('tbody');

    for(let row=0;row<config.numUsers;row++){
        const tr=document.createElement('tr');
        const th=document.createElement('th');
        th.textContent=getParticipantLabel(row);
        tr.appendChild(th);

        for(let col=0;col<config.numUsers;col++){
            const td=document.createElement('td');
            if(row===col){
                td.className='diagonal';
                td.textContent='‚Äî';
            } else {
                const input=document.createElement('input');
                input.type='number';
                input.min='1';
                input.max=config.numChoices;
                input.id=`cell-${row}-${col}`;
                input.addEventListener('input',function(){
                    this.value=this.value.replace(/[^0-9]/g,'');
                });
                td.appendChild(input);
            }
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    }

    const totalRow=document.createElement('tr');
    totalRow.className='totals-row';
    totalRow.innerHTML='<th>PUNTOS TOTALES</th>';
    for(let i=0;i<config.numUsers;i++){
        const td=document.createElement('td');
        td.id=`total-${i}`;
        td.textContent='0';
        totalRow.appendChild(td);
    }

    tbody.appendChild(totalRow);
    table.appendChild(tbody);
}


function validateAndCalculate() {
    const totals=new Array(config.numUsers).fill(0);
    for(let row=0;row<config.numUsers;row++){
        const used=[];
        for(let col=0;col<config.numUsers;col++){
            if(row===col) continue;

            const input=document.getElementById(`cell-${row}-${col}`);
            const value=input.value.trim();
            if(value!==''){
                const v=parseInt(value);
                if(v<1||v>config.numChoices) return;
                if(used.includes(v)) return;
                used.push(v);
            }
        }
    }

    for(let row=0;row<config.numUsers;row++){
        for(let col=0;col<config.numUsers;col++){
            if(row===col) continue;
            const input=document.getElementById(`cell-${row}-${col}`);
            const value=input.value.trim();
            if(value!==''){
                const pos=parseInt(value);
                totals[col]+=config.points[pos-1];
            }
        }
    }

    sociogramData.totals=[...totals];
    sociogramData.choices=[];

    for(let row=0;row<config.numUsers;row++){
        for(let col=0;col<config.numUsers;col++){
            if(row===col) continue;
            const input=document.getElementById(`cell-${row}-${col}`);
            const val=input.value.trim();
            if(val!==''){
                sociogramData.choices.push({from:row,to:col,order:parseInt(val)});
            }
        }
    }

    for(let i=0;i<config.numUsers;i++){
        document.getElementById(`total-${i}`).textContent=totals[i];
    }

    document.getElementById('successMsg').style.display='block';
    document.getElementById('btnSociogram').style.display='inline-block';
}


function resetConfig(){
    document.getElementById('configSection').style.display='block';
    document.getElementById('tableSection').style.display='none';
    document.getElementById('sociogramSection').style.display='none';
    document.getElementById('successMsg').style.display='none';
    document.getElementById('errorMsg').style.display='none';
    document.getElementById('btnSociogram').style.display='none';
}


function showSociogram(){
    document.getElementById('tableSection').style.display='none';
    document.getElementById('sociogramSection').style.display='block';
    document.getElementById('sociogramTitle').textContent=config.relationTitle;
    createLegendHTML();
    drawSociogram();
}

function showTable(){
    document.getElementById('sociogramSection').style.display='none';
    document.getElementById('tableSection').style.display='block';
}


function createLegendHTML(){
    const legend=document.getElementById('legendItems');
    legend.innerHTML='';
    for(let i=0;i<config.numChoices;i++){
        const color=arrowColors[i%arrowColors.length];
        const width=Math.max(8-i*1.5,2);
        const item=document.createElement('div');
        item.className='legend-item';

        const canvas=document.createElement('canvas');
        canvas.width=60;
        canvas.height=25;
        const ctx=canvas.getContext('2d');

        ctx.beginPath();
        ctx.moveTo(5,12);
        ctx.lineTo(45,12);
        ctx.strokeStyle=color;
        ctx.lineWidth=width;
        ctx.stroke();

        const head=10;
        ctx.beginPath();
        ctx.moveTo(45,12);
        ctx.lineTo(45-head*Math.cos(-Math.PI/6),12-head*Math.sin(-Math.PI/6));
        ctx.lineTo(45-head*Math.cos(Math.PI/6),12-head*Math.sin(Math.PI/6));
        ctx.fillStyle=color;
        ctx.fill();

        const text=document.createElement('span');
        text.className='legend-text';
        text.textContent=`${i+1}¬™ elecci√≥n (${config.points[i]} puntos)`;

        item.appendChild(canvas);
        item.appendChild(text);
        legend.appendChild(item);
    }
}


function drawSociogram(){
    const canvas=document.getElementById('sociogramCanvas');
    const ctx=canvas.getContext('2d');
    canvas.width=canvas.offsetWidth;
    canvas.height=canvas.offsetHeight;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const cx=canvas.width/2;
    const cy=canvas.height/2;
    const radius=Math.min(canvas.width,canvas.height)*0.35;

    const positions=[];
    for(let i=0;i<config.numUsers;i++){
        const angle=(i*2*Math.PI/config.numUsers)-Math.PI/2;
        positions.push({
            x:cx+radius*Math.cos(angle),
            y:cy+radius*Math.sin(angle),
            label:getParticipantLabel(i),
            points:sociogramData.totals[i]
        });
    }

    sociogramData.choices.forEach(choice=>{
        const from=positions[choice.from];
        const to=positions[choice.to];
        drawArrow(ctx,from.x,from.y,to.x,to.y,arrowColors[(choice.order-1)%arrowColors.length],Math.max(8-(choice.order-1)*1.5,2),positions);
    });

    const maxPoints=Math.max(...sociogramData.totals);
    const minR=25;
    const maxR=60;

    positions.forEach(p=>{
        let r=minR;
        if(maxPoints>0) r=minR+(maxR-minR)*(p.points/maxPoints);

        ctx.beginPath();
        ctx.arc(p.x,p.y,r,0,2*Math.PI);
        ctx.fillStyle='#667eea';
        ctx.fill();
        ctx.strokeStyle='#5568d3';
        ctx.lineWidth=3;
        ctx.stroke();

        ctx.fillStyle='white';
        ctx.font=`bold ${Math.min(r*0.7,24)}px Arial`;
        ctx.textAlign='center';
        ctx.textBaseline='middle';
        ctx.fillText(p.label,p.x,p.y);

        ctx.fillStyle='#333';
        ctx.font=`${Math.min(r*0.4,14)}px Arial`;
        ctx.fillText(`(${p.points})`,p.x,p.y+r+15);
    });
}


function drawArrow(ctx,x1,y1,x2,y2,color,width,positions){
    const angle=Math.atan2(y2-y1,x2-x1);
    const head=15+width;

    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.strokeStyle=color;
    ctx.lineWidth=width;
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(x2,y2);
    ctx.lineTo(x2-head*Math.cos(angle-Math.PI/6),y2-head*Math.sin(angle-M_PI/6));
    ctx.lineTo(x2-head*Math.cos(angle+Math.PI/6),y2-head*Math.sin(angle+Math.PI/6));
    ctx.fillStyle=color;
    ctx.fill();
}
</script>

</body>
</html>
