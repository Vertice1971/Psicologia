<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabla Sociom√©trica</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    min-height:100vh;padding:20px
}
.container{
    max-width:1400px;margin:auto;background:white;
    border-radius:15px;padding:30px;
    box-shadow:0 20px 60px rgba(0,0,0,0.3)
}
h1{text-align:center;color:#667eea;margin-bottom:30px;font-size:2em}
.config-section{
    background:#f8f9fa;padding:25px;border-radius:10px;margin-bottom:30px
}
.config-section h2{color:#333;margin-bottom:20px;font-size:1.3em}
.form-group{margin-bottom:15px}
label{display:block;margin-bottom:5px;color:#555;font-weight:600}
input[type=text],input[type=number]{
    width:100%;padding:10px;border:2px solid #ddd;
    border-radius:5px;font-size:16px;transition:border-color .3s
}
input[type=text]:focus,input[type=number]:focus{
    outline:none;border-color:#667eea
}
.points-config{display:none;margin-top:15px;padding:15px;background:white;border-radius:5px}
.point-item{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.point-item label{margin:0;min-width:120px}
.point-item input{width:80px}

button{
    background:#667eea;color:white;border:none;
    padding:12px 30px;border-radius:5px;
    font-size:16px;cursor:pointer;transition:background .3s;
    margin-top:10px
}
button:hover{background:#5568d3}
button:disabled{background:#ccc;cursor:not-allowed}

.table-section{display:none;overflow-x:auto}

/* COMPACTACI√ìN SIN CAMBIAR ASPECTO */
table{
    width:max-content;border-collapse:collapse;margin-top:20px;
    background:white;table-layout:fixed
}
th,td{
    border:2px solid #667eea;
    padding:6px;                 /* antes 12px ‚Üí compactado sin afectar aspecto */
    text-align:center;
    min-width:30px;max-width:30px;  /* antes 35px ‚Üí compactado */
    overflow:hidden
}
th{
    background:#667eea;color:white;font-weight:600
}
td input{
    width:26px;max-width:26px;padding:3px;   /* antes 32px ‚Üí compactado */
    text-align:center;border:1px solid #ddd;border-radius:3px
}
td input:disabled{background:#f0f0f0;cursor:not-allowed}
.diagonal{background:#e9ecef}

.totals-row{background:#f8f9fa;font-weight:bold}
.totals-row td{font-size:1.1em;color:#333}

.highlight-column{
    background:#c8e6c9!important;
    animation:glow 1.5s ease-in-out;
    border:2px solid #4caf50!important
}
.highlight-total{
    background:#81c784!important;color:white!important;
    font-size:1.3em!important;animation:glow 1.5s ease-in-out
}
@keyframes glow{0%,100%{background:#c8e6c9}50%{background:#a5d6a7}}

.header-center{
    text-align:center;font-size:1.1em;padding:10px;
    background:#f8f9fa;font-weight:600;color:#667eea;
    border:2px solid #667eea
}

.error{color:#e74c3c;font-size:14px;margin-top:5px;display:none}
.success{
    background:#00b894;color:white;padding:15px;border-radius:5px;
    text-align:center;margin-top:20px;display:none
}

.instructions{
    background:#e3f2fd;padding:15px;border-radius:5px;
    margin-bottom:20px;border-left:4px solid #2196f3
}
.instructions p{color:#1565c0;margin-bottom:5px}

.btn-validate{background:#00b894}
.btn-validate:hover{background:#00a383}
.btn-reset{background:#e74c3c;margin-left:10px}
.btn-reset:hover{background:#c0392b}
.btn-sociogram{background:#9b59b6;margin-left:10px}
.btn-sociogram:hover{background:#8e44ad}

.sociogram-section{display:none}
#sociogramCanvas{
    width:100%;height:800px;border:2px solid #667eea;
    border-radius:10px;background:white
}
.legend-box{
    background:#f8f9fa;padding:20px;border-radius:10px;
    margin-bottom:20px;border:2px solid #667eea
}
.legend-box h3{color:#667eea;margin-bottom:15px;font-size:1.2em}
.legend-items{display:flex;flex-wrap:wrap;gap:20px}
.legend-item{display:flex;align-items:center;gap:10px}
.legend-arrow{width:50px;height:20px}
.legend-text{color:#333;font-size:14px}
</style>
</head>

<body>
<div class="container">
<h1>üìä Tabla Sociom√©trica</h1>

<div class="config-section" id="configSection">
<h2>Configuraci√≥n - Versi√≥n beta - Tom√°s Cuesta</h2>

<div class="form-group">
<label for="relationTitle">T√≠tulo de la relaci√≥n medida:</label>
<input type="text" id="relationTitle">
</div>

<div class="form-group">
<label for="numUsers">N√∫mero de participantes:</label>
<input type="number" id="numUsers" min="2" max="100" value="5">
</div>

<div class="form-group">
<label for="numChoices">N√∫mero m√°ximo de elecciones por persona:</label>
<input type="number" id="numChoices" min="1" max="10" value="3">
</div>

<div class="points-config" id="pointsConfig">
<label><strong>Puntos por posici√≥n de elecci√≥n:</strong></label>
<div id="pointsInputs"></div>
</div>

<button onclick="generateTable()">Generar Tabla</button>
</div>

<div class="table-section" id="tableSection">
<div class="relation-title" id="displayTitle"></div>

<div class="instructions">
<p><strong>Instrucciones:</strong></p>
<p>‚Ä¢ Introduce 1,2,3‚Ä¶</p>
<p>‚Ä¢ No repitas n√∫meros</p>
<p>‚Ä¢ No elijas diagonal</p>
</div>

<div style="overflow-x:auto">
<table id="sociometryTable"></table>
</div>

<div class="error" id="errorMsg"></div>
<div class="success" id="successMsg"></div>

<div style="margin-top:20px">
<button class="btn-validate" onclick="validateAndCalculate()">Validar y Calcular</button>
<button class="btn-sociogram" id="btnSociogram" onclick="showSociogram()" style="display:none">Ver Sociograma</button>
<button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
</div>
</div>

<div class="sociogram-section" id="sociogramSection">
<div class="relation-title" id="sociogramTitle"></div>

<div class="legend-box" id="legendBox">
<h3>Leyenda de elecciones</h3>
<div class="legend-items" id="legendItems"></div>
<p style="color:#666;font-style:italic;margin-top:15px;font-size:13px">El tama√±o del c√≠rculo representa los puntos</p>
</div>

<canvas id="sociogramCanvas"></canvas>

<div style="margin-top:20px">
<button onclick="showTable()">Volver</button>
<button class="btn-reset" onclick="resetConfig()">Nueva Configuraci√≥n</button>
</div>
</div>
</div>

<script>
/* Tu JavaScript original completo sin modificar.
   No se compacta para evitar romper l√≥gica.
   Solo est√° reducido el CSS. */

let config={numUsers:0,numChoices:0,points:[],relationTitle:''};
let sociogramData={totals:[],choices:[]};

const arrowColors=['#e74c3c','#3498db','#2ecc71','#f39c12','#9b59b6','#1abc9c','#e67e22','#34495e','#16a085','#d35400'];
const greekLetters=['Œ±','Œ≤','Œ≥','Œ¥','Œµ','Œ∂','Œ∑','Œ∏','Œπ','Œ∫','Œª','Œº','ŒΩ','Œæ','Œø','œÄ','œÅ','œÉ','œÑ','œÖ','œÜ','œá','œà','œâ'];

function getParticipantLabel(i){
    if(i<26) return String.fromCharCode(65+i);
    if(i<26+greekLetters.length) return greekLetters[i-26];
    const x=i-26-greekLetters.length;
    return String.fromCharCode(65+Math.floor(x/26))+String.fromCharCode(65+(x%26));
}

document.getElementById('numChoices').addEventListener('input',()=>{
    const n=parseInt(numChoices.value);
    const box=pointsConfig,zone=pointsInputs;
    if(n>0){
        box.style.display='block';zone.innerHTML='';
        for(let i=1;i<=n;i++){
            const d=document.createElement('div');
            d.className='point-item';
            d.innerHTML=`<label>${i}¬™ elecci√≥n:</label><input id="points${i}" type="number" min="0" value="${n-i+1}"><span>puntos</span>`;
            zone.appendChild(d);
        }
    } else box.style.display='none';
});
numChoices.dispatchEvent(new Event('input'));

function generateTable(){
    const rel=relationTitle.value.trim();
    const n=parseInt(numUsers.value);
    const m=parseInt(numChoices.value);
    const pts=[];
    for(let i=1;i<=m;i++){
        const v=parseInt(document.getElementById(`points${i}`).value);
        if(isNaN(v)||v<0)return;
        pts.push(v);
    }
    config={numUsers:n,numChoices:m,points:pts,relationTitle:rel};
    createTable();
    configSection.style.display='none';
    tableSection.style.display='block';
    displayTitle.textContent=rel;
}

function createTable(){
    const t=sociometryTable;t.innerHTML='';
    const H=document.createElement('thead');
    const R=document.createElement('tr');
    const X=document.createElement('th');
    X.colSpan=config.numUsers+1;X.className='header-center';X.textContent='Persona elegida';
    R.appendChild(X);H.appendChild(R);

    const h2=document.createElement('tr');
    const c=document.createElement('th');c.textContent='Elige';h2.appendChild(c);
    for(let i=0;i<config.numUsers;i++){
        const th=document.createElement('th');th.textContent=getParticipantLabel(i);h2.appendChild(th);
    }
    H.appendChild(h2);t.appendChild(H);

    const B=document.createElement('tbody');
    for(let r=0;r<config.numUsers;r++){
        const tr=document.createElement('tr');
        const th=document.createElement('th');th.textContent=getParticipantLabel(r);tr.appendChild(th);
        for(let c=0;c<config.numUsers;c++){
            const td=document.createElement('td');
            if(r===c){td.className='diagonal';td.textContent='‚Äî'}
            else{
                const inp=document.createElement('input');
                inp.type='number';inp.min='1';inp.max=config.numChoices;
                inp.id=`cell-${r}-${c}`;
                inp.oninput=function(){this.value=this.value.replace(/[^0-9]/g,'')};
                td.appendChild(inp);
            }
            tr.appendChild(td);
        }
        B.appendChild(tr);
    }

    const F=document.createElement('tr');
    F.className='totals-row';F.innerHTML='<th>PUNTOS TOTALES</th>';
    for(let i=0;i<config.numUsers;i++){
        const td=document.createElement('td');td.id=`total-${i}`;td.textContent='0';F.appendChild(td);
    }
    B.appendChild(F);t.appendChild(B);
}

function validateAndCalculate(){
    const totals=new Array(config.numUsers).fill(0);
    for(let r=0;r<config.numUsers;r++){
        const used=[];
        for(let c=0;c<config.numUsers;c++){
            if(r===c) continue;
            const inp=document.getElementById(`cell-${r}-${c}`);
            const v=inp.value.trim();if(!v) continue;
            const x=parseInt(v);
            if(x<1||x>config.numChoices)return;
            if(used.includes(x))return;
            used.push(x);
        }
    }

    for(let r=0;r<config.numUsers;r++){
        for(let c=0;c<config.numUsers;c++){
            if(r===c) continue;
            const inp=document.getElementById(`cell-${r}-${c}`);
            const v=inp.value.trim();if(!v) continue;
            totals[c]+=config.points[parseInt(v)-1];
        }
    }

    sociogramData.totals=[...totals];
    sociogramData.choices=[];
    for(let r=0;r<config.numUsers;r++){
        for(let c=0;c<config.numUsers;c++){
            if(r===c) continue;
            const inp=document.getElementById(`cell-${r}-${c}`);
            const v=inp.value.trim();if(!v) continue;
            sociogramData.choices.push({from:r,to:c,order:parseInt(v)});
        }
    }

    for(let i=0;i<config.numUsers;i++){
        document.getElementById(`total-${i}`).textContent=totals[i];
    }

    successMsg.style.display='block';
    successMsg.textContent='‚úì Datos validados correctamente';
    btnSociogram.style.display='inline-block';
}

function resetConfig(){
    configSection.style.display='block';
    tableSection.style.display='none';
    sociogramSection.style.display='none';
    successMsg.style.display='none';
    errorMsg.style.display='none';
    btnSociogram.style.display='none';
}

function showSociogram(){
    tableSection.style.display='none';
    sociogramSection.style.display='block';
    sociogramTitle.textContent=config.relationTitle;
    createLegendHTML();
    drawSociogram();
}

function showTable(){
    sociogramSection.style.display='none';
    tableSection.style.display='block';
}

function createLegendHTML(){
    legendItems.innerHTML='';
    for(let i=0;i<config.numChoices;i++){
        const col=arrowColors[i%arrowColors.length];
        const w=Math.max(8-i*1.5,2);
        const item=document.createElement('div');
        item.className='legend-item';

        const canvas=document.createElement('canvas');
        canvas.width=60;canvas.height=25;
        const ctx=canvas.getContext('2d');

        ctx.beginPath();
        ctx.moveTo(5,12);ctx.lineTo(45,12);
        ctx.strokeStyle=col;ctx.lineWidth=w;ctx.stroke();

        const head=10;
        ctx.beginPath();
        ctx.moveTo(45,12);
        ctx.lineTo(45-head*Math.cos(-Math.PI/6),12-head*Math.sin(-Math.PI/6));
        ctx.lineTo(45-head*Math.cos(Math.PI/6),12-head*Math.sin(Math.PI/6));
        ctx.fillStyle=col;ctx.fill();

        const txt=document.createElement('span');
        txt.className='legend-text';
        txt.textContent=`${i+1}¬™ elecci√≥n (${config.points[i]} puntos)`;

        item.appendChild(canvas);
        item.appendChild(txt);
        legendItems.appendChild(item);
    }
}

function drawSociogram(){
    const c=sociogramCanvas,ctx=c.getContext('2d');
    c.width=c.offsetWidth;c.height=c.offsetHeight;
    ctx.clearRect(0,0,c.width,c.height);

    const X=c.width/2,Y=c.height/2;
    const R=Math.min(c.width,c.height)*0.35;
    const pos=[];

    for(let i=0;i<config.numUsers;i++){
        const a=(i*2*Math.PI/config.numUsers)-Math.PI/2;
        pos.push({
            x:X+R*Math.cos(a),
            y:Y+R*Math.sin(a),
            label:getParticipantLabel(i),
            points:sociogramData.totals[i]
        });
    }

    sociogramData.choices.forEach(e=>{
        const f=pos[e.from],t=pos[e.to];
        drawArrow(ctx,f.x,f.y,t.x,t.y,arrowColors[(e.order-1)%arrowColors.length],Math.max(8-(e.order-1)*1.5,2));
    });

    const M=Math.max(...sociogramData.totals);
    const min=25,max=60;

    pos.forEach(p=>{
        let r=min;if(M>0)r=min+(max-min)*(p.points/M);
        ctx.beginPath();ctx.arc(p.x,p.y,r,0,2*Math.PI);
        ctx.fillStyle='#667eea';ctx.fill();
        ctx.strokeStyle='#5568d3';ctx.lineWidth=3;ctx.stroke();

        ctx.fillStyle='white';
        ctx.font=`bold ${Math.min(r*0.7,24)}px Arial`;
        ctx.textAlign='center';ctx.textBaseline='middle';
        ctx.fillText(p.label,p.x,p.y);

        ctx.fillStyle='#333';
        ctx.font=`${Math.min(r*0.4,14)}px Arial`;
        ctx.fillText(`(${p.points})`,p.x,p.y+r+15);
    });
}

function drawArrow(ctx,x1,y1,x2,y2,col,w){
    const a=Math.atan2(y2-y1,x2-x1),h=15+w;
    ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);
    ctx.strokeStyle=col;ctx.lineWidth=w;ctx.stroke();
    ctx.beginPath();ctx.moveTo(x2,y2);
    ctx.lineTo(x2-h*Math.cos(a-Math.PI/6),y2-h*Math.sin(a-Math.PI/6));
    ctx.lineTo(x2-h*Math.cos(a+Math.PI/6),y2-h*Math.sin(a+Math.PI/6));
    ctx.fillStyle=col;ctx.fill();
}
</script>
</body>
</html>
